# æ ¡å›­Java-OJç³»ç»Ÿå¼€å‘æ¥å£è®¾è®¡

## ğŸ“¡ APIæ¥å£è§„èŒƒ

### 1. æ¥å£è®¾è®¡åŸåˆ™

- **RESTfulè®¾è®¡**: éµå¾ªRESTè§„èŒƒï¼Œè¯­ä¹‰åŒ–URL
- **ç»Ÿä¸€å“åº”æ ¼å¼**: æ‰€æœ‰æ¥å£è¿”å›ç»Ÿä¸€çš„JSONæ ¼å¼
- **ç‰ˆæœ¬æ§åˆ¶**: APIç‰ˆæœ¬é€šè¿‡URLè·¯å¾„æ§åˆ¶ `/api/v1/`
- **è®¤è¯æˆæƒ**: JWT Token + RBACæƒé™æ§åˆ¶
- **å‚æ•°æ ¡éªŒ**: ä¸¥æ ¼çš„è¾“å…¥å‚æ•°éªŒè¯
- **é”™è¯¯å¤„ç†**: æ ‡å‡†åŒ–é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯

### 2. é€šç”¨å“åº”æ ¼å¼

```go
// æ ‡å‡†å“åº”ç»“æ„
type Response struct {
    Code    int         `json:"code"`    // çŠ¶æ€ç 
    Message string      `json:"message"` // æç¤ºä¿¡æ¯
    Data    interface{} `json:"data"`    // å“åº”æ•°æ®
    TraceID string      `json:"trace_id,omitempty"` // é“¾è·¯è¿½è¸ªID
}

// åˆ†é¡µå“åº”ç»“æ„
type PageResponse struct {
    Response
    Pagination Pagination `json:"pagination"`
}

type Pagination struct {
    Page     int   `json:"page"`      // å½“å‰é¡µç 
    PageSize int   `json:"page_size"` // æ¯é¡µå¤§å°
    Total    int64 `json:"total"`     // æ€»è®°å½•æ•°
    Pages    int   `json:"pages"`     // æ€»é¡µæ•°
}
```

### 3. çŠ¶æ€ç å®šä¹‰

```go
const (
    // æˆåŠŸçŠ¶æ€ç 
    CodeSuccess = 200

    // å®¢æˆ·ç«¯é”™è¯¯ 4xx
    CodeInvalidParam     = 400  // å‚æ•°é”™è¯¯
    CodeUnauthorized     = 401  // æœªè®¤è¯
    CodeForbidden        = 403  // æ— æƒé™
    CodeNotFound         = 404  // èµ„æºä¸å­˜åœ¨
    CodeDuplicateSubmit  = 429  // é‡å¤æäº¤

    // æœåŠ¡ç«¯é”™è¯¯ 5xx
    CodeInternalError    = 500  // å†…éƒ¨é”™è¯¯
    CodeDatabaseError    = 501  // æ•°æ®åº“é”™è¯¯
    CodeJudgeError       = 502  // åˆ¤é¢˜é”™è¯¯
    CodeServiceUnavail   = 503  // æœåŠ¡ä¸å¯ç”¨
)
```

## ğŸ” è®¤è¯æˆæƒæ¥å£

### 1. ç”¨æˆ·æ³¨å†Œ
```
POST /api/v1/auth/register
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
    "student_id": "2021001001",
    "username": "zhang_san",
    "password": "123456",
    "email": "zhangsan@school.edu.cn",
    "real_name": "å¼ ä¸‰",
    "class": "è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯2021-1ç­",
    "grade": "2021"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "æ³¨å†ŒæˆåŠŸ",
    "data": {
        "user_id": "64f8a123b45c6789d0123456",
        "username": "zhang_san",
        "email": "zhangsan@school.edu.cn"
    }
}
```

### 2. ç”¨æˆ·ç™»å½•
```
POST /api/v1/auth/login
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
    "username": "zhang_san",
    "password": "123456"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "ç™»å½•æˆåŠŸ",
    "data": {
        "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "token_type": "Bearer",
        "expires_in": 86400,
        "user": {
            "id": "64f8a123b45c6789d0123456",
            "username": "zhang_san",
            "real_name": "å¼ ä¸‰",
            "role": "student",
            "class": "è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯2021-1ç­"
        }
    }
}
```

### 3. ç”¨æˆ·ç™»å‡º
```
POST /api/v1/auth/logout
Authorization: Bearer {access_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "ç™»å‡ºæˆåŠŸ",
    "data": null
}
```

## ğŸ‘¤ ç”¨æˆ·ç®¡ç†æ¥å£

### 1. è·å–ç”¨æˆ·ä¿¡æ¯
```
GET /api/v1/users/profile
Authorization: Bearer {access_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": "64f8a123b45c6789d0123456",
        "student_id": "2021001001",
        "username": "zhang_san",
        "email": "zhangsan@school.edu.cn",
        "real_name": "å¼ ä¸‰",
        "role": "student",
        "class": "è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯2021-1ç­",
        "grade": "2021",
        "stats": {
            "total_submissions": 45,
            "accepted_count": 23,
            "problems_solved": 18,
            "ranking": 12
        },
        "created_at": "2024-01-15T10:30:00Z"
    }
}
```

### 2. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```
PUT /api/v1/users/profile
Authorization: Bearer {access_token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
    "email": "new_email@school.edu.cn",
    "avatar": "http://example.com/avatar.jpg"
}
```

### 3. ä¿®æ”¹å¯†ç 
```
PUT /api/v1/users/password
Authorization: Bearer {access_token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
    "old_password": "123456",
    "new_password": "654321"
}
```

## ğŸ“‹ é¢˜ç›®ç®¡ç†æ¥å£

### 1. è·å–é¢˜ç›®åˆ—è¡¨
```
GET /api/v1/problems?page=1&page_size=20&difficulty=easy&tags=array,string
Authorization: Bearer {access_token}
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç (é»˜è®¤1)
- `page_size`: æ¯é¡µå¤§å°(é»˜è®¤20ï¼Œæœ€å¤§100)
- `difficulty`: éš¾åº¦ç­›é€‰(easy/medium/hard)
- `tags`: æ ‡ç­¾ç­›é€‰(é€—å·åˆ†éš”)
- `keyword`: å…³é”®è¯æœç´¢

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "id": "64f8a123b45c6789d0123457",
            "title": "ä¸¤æ•°ä¹‹å’Œ",
            "difficulty": "easy",
            "tags": ["array", "hash-table"],
            "acceptance_rate": 0.65,
            "total_submissions": 1250,
            "accepted_count": 812,
            "created_at": "2024-01-10T08:00:00Z"
        }
    ],
    "pagination": {
        "page": 1,
        "page_size": 20,
        "total": 156,
        "pages": 8
    }
}
```

### 2. è·å–é¢˜ç›®è¯¦æƒ…
```
GET /api/v1/problems/{problem_id}
Authorization: Bearer {access_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": "64f8a123b45c6789d0123457",
        "title": "ä¸¤æ•°ä¹‹å’Œ",
        "description": "ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ target...",
        "input_format": "ç¬¬ä¸€è¡ŒåŒ…å«æ•°ç»„é•¿åº¦nå’Œç›®æ ‡å€¼target...",
        "output_format": "è¾“å‡ºä¸¤ä¸ªæ•´æ•°çš„ä¸‹æ ‡...",
        "sample_input": "4 9\n2 7 11 15",
        "sample_output": "0 1",
        "time_limit": 1000,
        "memory_limit": 128,
        "difficulty": "easy",
        "tags": ["array", "hash-table"],
        "stats": {
            "total_submissions": 1250,
            "accepted_count": 812,
            "acceptance_rate": 0.65
        },
        "created_by": "teacher_wang",
        "created_at": "2024-01-10T08:00:00Z"
    }
}
```

### 3. åˆ›å»ºé¢˜ç›® (æ•™å¸ˆæƒé™)
```
POST /api/v1/problems
Authorization: Bearer {access_token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
    "title": "æ–°é¢˜ç›®æ ‡é¢˜",
    "description": "é¢˜ç›®æè¿°...",
    "input_format": "è¾“å…¥æ ¼å¼è¯´æ˜...",
    "output_format": "è¾“å‡ºæ ¼å¼è¯´æ˜...",
    "sample_input": "æ ·ä¾‹è¾“å…¥",
    "sample_output": "æ ·ä¾‹è¾“å‡º",
    "time_limit": 1000,
    "memory_limit": 128,
    "difficulty": "medium",
    "tags": ["algorithm", "dp"],
    "test_cases": [
        {
            "input": "æµ‹è¯•è¾“å…¥1",
            "output": "æœŸæœ›è¾“å‡º1",
            "score": 20,
            "is_public": false
        }
    ]
}
```

## ğŸ“ ä»£ç æäº¤æ¥å£

### 1. æäº¤ä»£ç 
```
POST /api/v1/submissions
Authorization: Bearer {access_token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
    "problem_id": "64f8a123b45c6789d0123457",
    "code": "public class Main {\n    public static void main(String[] args) {\n        // Javaè§£é¢˜ä»£ç \n        System.out.println(\"Hello World\");\n    }\n}",
    "language": "java"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "æäº¤æˆåŠŸ",
    "data": {
        "submission_id": "64f8a123b45c6789d0123458",
        "status": "PENDING",
        "submitted_at": "2024-01-15T14:30:00Z",
        "judge_info": {
            "estimated_time": "15s",
            "queue_position": 3
        }
    }
}
```

### 2. æŸ¥è¯¢æäº¤çŠ¶æ€
```
GET /api/v1/submissions/{submission_id}
Authorization: Bearer {access_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": "64f8a123b45c6789d0123458",
        "problem_id": "64f8a123b45c6789d0123457",
        "user_id": "64f8a123b45c6789d0123456",
        "code": "public class Main {...}",
        "language": "java",
        "status": "ACCEPTED",
        "score": 100,
        "time_used": 245,
        "memory_used": 8192,
        "compile_info": {
            "status": "SUCCESS",
            "time_used": 2456,
            "memory_used": 45678,
            "message": ""
        },
        "test_results": [
            {
                "test_case_id": "case1",
                "status": "ACCEPTED",
                "time_used": 45,
                "memory_used": 2048,
                "score": 20,
                "input": "4 9\n2 7 11 15",
                "expected_output": "0 1",
                "actual_output": "0 1",
                "judge_details": {
                    "go_judge_status": "Accepted",
                    "exit_status": 0,
                    "runtime_ns": 45000000
                }
            }
        ],
        "submitted_at": "2024-01-15T14:30:00Z",
        "judged_at": "2024-01-15T14:30:15Z"
    }
}
```

### 3. è·å–æäº¤åˆ—è¡¨
```
GET /api/v1/submissions?page=1&page_size=20&problem_id=xxx&status=ACCEPTED
Authorization: Bearer {access_token}
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç 
- `page_size`: æ¯é¡µå¤§å°
- `problem_id`: é¢˜ç›®IDç­›é€‰
- `status`: çŠ¶æ€ç­›é€‰
- `language`: è¯­è¨€ç­›é€‰

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "id": "64f8a123b45c6789d0123458",
            "problem": {
                "id": "64f8a123b45c6789d0123457",
                "title": "ä¸¤æ•°ä¹‹å’Œ"
            },
            "status": "ACCEPTED",
            "score": 100,
            "time_used": 245,
            "memory_used": 8192,
            "language": "java",
            "submitted_at": "2024-01-15T14:30:00Z"
        }
    ],
    "pagination": {
        "page": 1,
        "page_size": 20,
        "total": 45,
        "pages": 3
    }
}
```

## ğŸ“Š ç»Ÿè®¡åˆ†ææ¥å£

### 1. ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
```
GET /api/v1/stats/user/{user_id}
Authorization: Bearer {access_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "user": {
            "id": "64f8a123b45c6789d0123456",
            "username": "zhang_san",
            "real_name": "å¼ ä¸‰"
        },
        "summary": {
            "total_submissions": 45,
            "accepted_count": 23,
            "problems_solved": 18,
            "acceptance_rate": 0.51,
            "ranking": 12
        },
        "difficulty_stats": {
            "easy": {"solved": 8, "total": 10},
            "medium": {"solved": 7, "total": 15},
            "hard": {"solved": 3, "total": 8}
        },
        "recent_submissions": [
            {
                "problem_title": "ä¸¤æ•°ä¹‹å’Œ",
                "status": "ACCEPTED",
                "submitted_at": "2024-01-15T14:30:00Z"
            }
        ]
    }
}
```

### 2. ç­çº§æ’è¡Œæ¦œ
```
GET /api/v1/stats/ranking/class/{class_name}?page=1&page_size=50
Authorization: Bearer {access_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "rank": 1,
            "user": {
                "id": "64f8a123b45c6789d0123456",
                "username": "zhang_san",
                "real_name": "å¼ ä¸‰",
                "student_id": "2021001001"
            },
            "stats": {
                "problems_solved": 25,
                "total_submissions": 68,
                "acceptance_rate": 0.74,
                "last_submission": "2024-01-15T16:45:00Z"
            }
        }
    ],
    "pagination": {
        "page": 1,
        "page_size": 50,
        "total": 32,
        "pages": 1
    }
}
```

### 3. é¢˜ç›®ç»Ÿè®¡ä¿¡æ¯
```
GET /api/v1/stats/problem/{problem_id}
Authorization: Bearer {access_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "problem": {
            "id": "64f8a123b45c6789d0123457",
            "title": "ä¸¤æ•°ä¹‹å’Œ"
        },
        "stats": {
            "total_submissions": 1250,
            "accepted_count": 812,
            "acceptance_rate": 0.65,
            "average_time": 245,
            "average_memory": 8192
        },
        "language_stats": {
            "java": {"submissions": 1250, "accepted": 812}
        },
        "difficulty_distribution": {
            "user_ratings": {"easy": 45, "medium": 12, "hard": 3}
        }
    }
}
```

## ğŸ”§ ç®¡ç†å‘˜æ¥å£

### 1. ç³»ç»Ÿç›‘æ§
```
GET /api/v1/admin/system/status
Authorization: Bearer {access_token}
X-Role: admin
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "system": {
            "uptime": "15d 6h 32m",
            "version": "v1.0.0",
            "environment": "production"
        },
        "database": {
            "mongodb": {
                "status": "healthy",
                "connections": 25,
                "response_time": "2ms"
            },
            "redis": {
                "status": "healthy",
                "memory_usage": "156MB",
                "hit_rate": 0.95
            }
        },
        "queue": {
            "rabbitmq": {
                "status": "healthy",
                "pending_tasks": 3,
                "processing_rate": "45/min"
            }
        },
        "judge": {
            "sandboxes": [
                {
                    "id": "sandbox-1",
                    "status": "healthy",
                    "cpu_usage": 0.15,
                    "memory_usage": 0.32
                }
            ]
        }
    }
}
```

### 2. ç”¨æˆ·ç®¡ç†
```
GET /api/v1/admin/users?page=1&page_size=50&role=student&class=è®¡ç®—æœº2021-1ç­
Authorization: Bearer {access_token}
X-Role: admin
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "id": "64f8a123b45c6789d0123456",
            "student_id": "2021001001",
            "username": "zhang_san",
            "real_name": "å¼ ä¸‰",
            "role": "student",
            "class": "è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯2021-1ç­",
            "is_active": true,
            "last_login": "2024-01-15T16:45:00Z",
            "stats": {
                "problems_solved": 18,
                "total_submissions": 45
            }
        }
    ]
}
```

## ğŸ”Œ WebSocketå®æ—¶é€šçŸ¥

### 1. è¿æ¥å»ºç«‹
```
WebSocket: ws://localhost:8080/api/v1/ws
Authorization: Bearer {access_token}
```

### 2. åˆ¤é¢˜ç»“æœé€šçŸ¥
```json
{
    "type": "submission_result",
    "data": {
        "submission_id": "64f8a123b45c6789d0123458",
        "status": "ACCEPTED",
        "score": 100,
        "time_used": 245,
        "memory_used": 8192,
        "judged_at": "2024-01-15T14:30:15Z",
        "compile_info": {
            "status": "SUCCESS",
            "time_used": 2456,
            "memory_used": 59801600,
            "message": ""
        },
        "test_progress": {
            "current_case": 5,
            "total_cases": 5,
            "passed_cases": 5
        },
        "judge_details": {
            "sandbox_instance": "go-judge-1",
            "file_cache_cleared": true,
            "total_judge_time": "12.5s",
            "compile_time_ns": 870867000,
            "avg_run_time_ns": 123456789
        }
    }
}
```

### 3. åˆ¤é¢˜è¿›åº¦é€šçŸ¥ï¼ˆå¯¹åº”go-judgeå„é˜¶æ®µï¼‰
```json
{
    "type": "judge_progress",
    "data": {
        "submission_id": "64f8a123b45c6789d0123458",
        "stage": "COMPILING", // COMPILING, RUNNING, COMPLETED
        "progress": {
            "stage_name": "ç¼–è¯‘ä¸­",
            "current_step": 1,
            "total_steps": 6,
            "current_test_case": 0,
            "total_test_cases": 5,
            "go_judge_request": "POST /run (javac)"
        },
        "timestamp": "2024-01-15T14:30:08Z"
    }
}
```

### 4. ç¼–è¯‘é˜¶æ®µé€šçŸ¥
```json
{
    "type": "compile_result",
    "data": {
        "submission_id": "64f8a123b45c6789d0123458",
        "compile_status": "SUCCESS", // SUCCESS, FAILED
        "go_judge_response": {
            "status": "Accepted",
            "exitStatus": 0,
            "time": 870867000,
            "memory": 59801600,
            "fileIds": {
                "Main.class": "ABC123DEF456"
            }
        },
        "message": "ç¼–è¯‘æˆåŠŸï¼Œå¼€å§‹è¿è¡Œæµ‹è¯•ç”¨ä¾‹",
        "timestamp": "2024-01-15T14:30:10Z"
    }
}
```

### 5. å•ä¸ªæµ‹è¯•ç”¨ä¾‹ç»“æœé€šçŸ¥
```json
{
    "type": "test_case_result",
    "data": {
        "submission_id": "64f8a123b45c6789d0123458",
        "test_case_id": "case1",
        "test_case_index": 1,
        "status": "ACCEPTED",
        "score": 20,
        "go_judge_response": {
            "status": "Accepted",
            "exitStatus": 0,
            "time": 123456789,
            "memory": 45678912,
            "files": {
                "stdout": "0 1\n",
                "stderr": ""
            }
        },
        "expected_output": "0 1",
        "actual_output": "0 1",
        "judge_matched": true,
        "timestamp": "2024-01-15T14:30:12Z"
    }
}
```

### 4. æ”¯æŒçš„æ¶ˆæ¯ç±»å‹
- `judge_progress`: åˆ¤é¢˜è¿›åº¦é€šçŸ¥(ç¼–è¯‘ä¸­/è¿è¡Œä¸­/å®Œæˆ)
- `submission_result`: åˆ¤é¢˜ç»“æœé€šçŸ¥(æœ€ç»ˆç»“æœ)
- `test_case_result`: å•ä¸ªæµ‹è¯•ç”¨ä¾‹ç»“æœ
- `compile_result`: ç¼–è¯‘ç»“æœé€šçŸ¥
- `ranking_update`: æ’åæ›´æ–°é€šçŸ¥
- `system_notice`: ç³»ç»Ÿé€šçŸ¥
- `contest_update`: ç«èµ›æ›´æ–°(é¢„ç•™)

## ğŸ› ï¸ é”™è¯¯å¤„ç†

### 1. å¸¸è§é”™è¯¯å“åº”
```json
{
    "code": 400,
    "message": "å‚æ•°é”™è¯¯",
    "data": {
        "errors": [
            {
                "field": "code",
                "message": "ä»£ç ä¸èƒ½ä¸ºç©º"
            }
        ]
    },
    "trace_id": "abc123def456"
}
```

### 2. åˆ¤é¢˜ç›¸å…³é”™è¯¯ç 

| é”™è¯¯ç  | æè¿° | go-judgeçŠ¶æ€æ˜ å°„ | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------------|----------|
| 1001 | ç”¨æˆ·åå·²å­˜åœ¨ | - | æ›´æ¢ç”¨æˆ·å |
| 1002 | é‚®ç®±å·²è¢«æ³¨å†Œ | - | æ›´æ¢é‚®ç®±æˆ–æ‰¾å›å¯†ç  |
| 1003 | å¯†ç é”™è¯¯ | - | æ£€æŸ¥å¯†ç è¾“å…¥ |
| 2001 | é¢˜ç›®ä¸å­˜åœ¨ | - | æ£€æŸ¥é¢˜ç›®ID |
| 2002 | æ— æƒé™è®¿é—®é¢˜ç›® | - | è”ç³»ç®¡ç†å‘˜ |
| 3001 | ä»£ç é•¿åº¦è¶…é™ | - | ç²¾ç®€ä»£ç  |
| 3002 | é‡å¤æäº¤ | - | ç­‰å¾…10ç§’åé‡è¯• |
| 3003 | åˆ¤é¢˜é˜Ÿåˆ—æ»¡ | - | ç¨åé‡è¯• |
| 3100 | ç¼–è¯‘é”™è¯¯ | Nonzero Exit Status | æ£€æŸ¥Javaè¯­æ³• |
| 3101 | è¿è¡Œæ—¶é”™è¯¯ | Signalled/Nonzero Exit Status | æ£€æŸ¥ç¨‹åºé€»è¾‘ |
| 3102 | å†…å­˜è¶…é™ | Memory Limit Exceeded | ä¼˜åŒ–å†…å­˜ä½¿ç”¨ |
| 3103 | æ—¶é—´è¶…é™ | Time Limit Exceeded | ä¼˜åŒ–ç®—æ³•æ•ˆç‡ |
| 3104 | è¾“å‡ºè¶…é™ | Output Limit Exceeded | æ£€æŸ¥è¾“å‡ºæ ¼å¼ |
| 3105 | å±é™©ç³»ç»Ÿè°ƒç”¨ | Dangerous Syscall | å®‰å…¨æ£€æŸ¥æ‹’ç»æ‰§è¡Œ |
| 3106 | æ²™ç®±å†…éƒ¨é”™è¯¯ | Internal Error | è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ |
| 3107 | æ–‡ä»¶æ“ä½œé”™è¯¯ | File Error | æ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæƒé™ |

### 2. ä¸šåŠ¡é”™è¯¯ç 

| é”™è¯¯ç  | æè¿° | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| 1001 | ç”¨æˆ·åå·²å­˜åœ¨ | æ›´æ¢ç”¨æˆ·å |
| 1002 | é‚®ç®±å·²è¢«æ³¨å†Œ | æ›´æ¢é‚®ç®±æˆ–æ‰¾å›å¯†ç  |
| 1003 | å¯†ç é”™è¯¯ | æ£€æŸ¥å¯†ç è¾“å…¥ |
| 2001 | é¢˜ç›®ä¸å­˜åœ¨ | æ£€æŸ¥é¢˜ç›®ID |
| 2002 | æ— æƒé™è®¿é—®é¢˜ç›® | è”ç³»ç®¡ç†å‘˜ |
| 3001 | ä»£ç é•¿åº¦è¶…é™ | ç²¾ç®€ä»£ç  |
### 3. go-judgeçŠ¶æ€ç å¯¹ç…§è¡¨

| go-judgeçŠ¶æ€ | OJç³»ç»ŸçŠ¶æ€ | ä¸­æ–‡æè¿° | å¤„ç†é€»è¾‘ |
|-----------------|--------------|----------|----------|
| `Accepted` | `ACCEPTED` | é€šè¿‡ | æ­£å¸¸å¤„ç† |
| `Memory Limit Exceeded` | `MEMORY_LIMIT_EXCEEDED` | å†…å­˜è¶…é™ | è®°å½•å†…å­˜ä½¿ç”¨é‡ |
| `Time Limit Exceeded` | `TIME_LIMIT_EXCEEDED` | æ—¶é—´è¶…é™ | è®°å½•æ—¶é—´ä½¿ç”¨é‡ |
| `Output Limit Exceeded` | `OUTPUT_LIMIT_EXCEEDED` | è¾“å‡ºè¶…é™ | æ£€æŸ¥è¾“å‡ºé•¿åº¦ |
| `Nonzero Exit Status` | `RUNTIME_ERROR` / `COMPILE_ERROR` | éé›¶é€€å‡º | æ ¹æ®é˜¶æ®µåŒºåˆ†ç¼–è¯‘/è¿è¡Œé”™è¯¯ |
| `Signalled` | `RUNTIME_ERROR` | ä¿¡å·ç»ˆæ­¢ | æ®µé”™è¯¯ç­‰è¿è¡Œæ—¶é—®é¢˜ |
| `Dangerous Syscall` | `DANGEROUS_SYSCALL` | å±é™©ç³»ç»Ÿè°ƒç”¨ | å®‰å…¨æ£€æŸ¥æ‹’ç» |
| `File Error` | `SYSTEM_ERROR` | æ–‡ä»¶é”™è¯¯ | ç³»ç»Ÿå†…éƒ¨é”™è¯¯ |
| `Internal Error` | `SYSTEM_ERROR` | å†…éƒ¨é”™è¯¯ | ç³»ç»Ÿå†…éƒ¨é”™è¯¯ |

## ğŸ“‹ æ¥å£æµ‹è¯•

### 1. Postmané›†åˆ
æä¾›å®Œæ•´çš„Postmanæµ‹è¯•é›†åˆï¼ŒåŒ…å«ï¼š
- ç¯å¢ƒå˜é‡é…ç½®
- è®¤è¯Tokenè‡ªåŠ¨æ›´æ–°
- æ‰€æœ‰æ¥å£çš„æµ‹è¯•ç”¨ä¾‹
- è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- go-judgeæ²™ç®±çŠ¶æ€æ¨¡æ‹Ÿ

### 2. APIæ–‡æ¡£
åŸºäºOpenAPI 3.0è§„èŒƒç”Ÿæˆï¼š
- Swagger UIç•Œé¢
- åœ¨çº¿æµ‹è¯•åŠŸèƒ½
- ä»£ç ç”Ÿæˆå·¥å…·
- æ¥å£å˜æ›´å†å²
- go-judgeé›†æˆæ–‡æ¡£

### 3. SDKæ”¯æŒ
æä¾›å¤šè¯­è¨€SDKï¼š
- JavaScript/TypeScript - åŒ…å«go-judgeå®¢æˆ·ç«¯
- Python - æ”¯æŒå¼‚æ­¥è°ƒç”¨
- Java - Spring Booté›†æˆ
- Go - åŸç”ŸHTTPå®¢æˆ·ç«¯

### 4. åˆ¤é¢˜é›†æˆæµ‹è¯•

#### go-judgeæ¥å£å®Œæ•´æµç¨‹æµ‹è¯•

**æ­¥éª¤1: å¥åº·æ£€æŸ¥**
```bash
# æµ‹è¯•go-judgeè¿æ¥
curl -X GET http://localhost:5050/version
```

**æ­¥éª¤2: Javaç¼–è¯‘æµ‹è¯•**
```bash
# æµ‹è¯•Javaç¼–è¯‘ - å®Œæ•´è¯·æ±‚ç¤ºä¾‹
curl -X POST http://localhost:5050/run \
  -H "Content-Type: application/json" \
  -d '{
    "cmd": [{
      "args": ["/usr/bin/javac", "Main.java"],
      "env": [
        "PATH=/usr/bin:/bin",
        "JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64"
      ],
      "files": [
        {"content": ""},
        {"name": "stdout", "max": 10240},
        {"name": "stderr", "max": 10240}
      ],
      "cpuLimit": 10000000000,
      "memoryLimit": 268435456,
      "procLimit": 50,
      "copyIn": {
        "Main.java": {
          "content": "public class Main {\n    public static void main(String[] args) {\n        System.out.println(\"Hello World\");\n    }\n}"
        }
      },
      "copyOut": ["stdout", "stderr"],
      "copyOutCached": ["Main.class"]
    }]
  }'
```

**æœŸæœ›ç¼–è¯‘å“åº”**:
```json
[{
  "status": "Accepted",
  "exitStatus": 0,
  "time": 870867000,
  "memory": 59801600,
  "runTime": 360798111,
  "files": {
    "stderr": "",
    "stdout": ""
  },
  "fileIds": {
    "Main.class": "ABC123DEF456"
  }
}]
```

**æ­¥éª¤3: Javaè¿è¡Œæµ‹è¯•**
```bash
# æµ‹è¯•Javaè¿è¡Œ - ä½¿ç”¨ç¼“å­˜æ–‡ä»¶ID
curl -X POST http://localhost:5050/run \
  -H "Content-Type: application/json" \
  -d '{
    "cmd": [{
      "args": ["/usr/bin/java", "Main"],
      "env": [
        "PATH=/usr/bin:/bin",
        "JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64"
      ],
      "files": [
        {"content": "æµ‹è¯•è¾“å…¥æ•°æ®"},
        {"name": "stdout", "max": 10240},
        {"name": "stderr", "max": 10240}
      ],
      "cpuLimit": 5000000000,
      "memoryLimit": 134217728,
      "procLimit": 1,
      "copyIn": {
        "Main.class": {"fileId": "ABC123DEF456"}
      },
      "copyOut": ["stdout", "stderr"]
    }]
  }'
```

**æœŸæœ›è¿è¡Œå“åº”**:
```json
[{
  "status": "Accepted",
  "exitStatus": 0,
  "time": 123456789,
  "memory": 45678912,
  "runTime": 234567890,
  "files": {
    "stderr": "",
    "stdout": "Hello World\n"
  },
  "fileIds": {}
}]
```

**æ­¥éª¤4: æ¸…ç†ç¼“å­˜æ–‡ä»¶**
```bash
# åˆ é™¤ç¼“å­˜çš„classæ–‡ä»¶
curl -X DELETE http://localhost:5050/file/ABC123DEF456
```

#### é”™è¯¯æƒ…å†µæµ‹è¯•

**ç¼–è¯‘é”™è¯¯æµ‹è¯•**:
```bash
# æäº¤è¯­æ³•é”™è¯¯çš„Javaä»£ç 
curl -X POST http://localhost:5050/run \
  -H "Content-Type: application/json" \
  -d '{
    "cmd": [{
      "args": ["/usr/bin/javac", "Main.java"],
      "env": ["PATH=/usr/bin:/bin", "JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64"],
      "files": [{"content": ""}, {"name": "stdout", "max": 10240}, {"name": "stderr", "max": 10240}],
      "cpuLimit": 10000000000,
      "memoryLimit": 268435456,
      "copyIn": {
        "Main.java": {
          "content": "public class Main { // è¯­æ³•é”™è¯¯çš„ä»£ç  }"
        }
      },
      "copyOut": ["stdout", "stderr"]
    }]
  }'
```

**æœŸæœ›ç¼–è¯‘é”™è¯¯å“åº”**:
```json
[{
  "status": "Nonzero Exit Status",
  "exitStatus": 1,
  "time": 500000000,
  "memory": 45678912,
  "files": {
    "stdout": "",
    "stderr": "Main.java:1: error: reached end of file while parsing\n"
  }
}]
```

## ğŸ”„ åˆ¤é¢˜æµç¨‹ä¸go-judgeå¯¹æ¥ç»†èŠ‚

### 1. å®Œæ•´çš„åˆ¤é¢˜æµç¨‹æ˜ å°„

```mermaid
sequenceDiagram
    participant OJ as OJç³»ç»Ÿ
    participant GJ as go-judgeæ²™ç®±
    participant DB as æ•°æ®åº“
    
    Note over OJ,DB: 1. ä»£ç æäº¤é˜¶æ®µ
    OJ->>DB: åˆ›å»ºæäº¤è®°å½•(status: PENDING)
    OJ->>OJ: è¿”å›submission_idç»™ç”¨æˆ·
    
    Note over OJ,DB: 2. å¼‚æ­¥åˆ¤é¢˜é˜¶æ®µ
    OJ->>GJ: POST /run (ç¼–è¯‘Java)
    GJ-->>OJ: è¿”å›ç¼–è¯‘ç»“æœ+classæ–‡ä»¶ID
    
    alt ç¼–è¯‘æˆåŠŸ
        loop æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹
            OJ->>GJ: POST /run (è¿è¡Œï¼Œä½¿ç”¨fileId)
            GJ-->>OJ: è¿”å›è¿è¡Œç»“æœ
            OJ->>OJ: æ¯”å¯¹è¾“å‡ºï¼Œè®¡ç®—å¾—åˆ†
        end
        OJ->>GJ: DELETE /file/{fileId}
        OJ->>DB: æ›´æ–°æœ€ç»ˆç»“æœ(status: ACCEPTED/WAç­‰)
    else ç¼–è¯‘å¤±è´¥
        OJ->>DB: æ›´æ–°ç»“æœ(status: COMPILE_ERROR)
    end
    
    Note over OJ,DB: 3. ç»“æœé€šçŸ¥
    OJ->>OJ: WebSocketæ¨é€ç»“æœç»™å‰ç«¯
```

### 2. å…³é”®æ•°æ®è½¬æ¢è§„åˆ™

#### æ—¶é—´è½¬æ¢
- go-judgeè¿”å›: `"time": 123456789` (çº³ç§’)
- OJç³»ç»Ÿå­˜å‚¨: `"time_used": 123` (æ¯«ç§’)
- è½¬æ¢å…¬å¼: `time_used = time / 1000000`

#### å†…å­˜è½¬æ¢
- go-judgeè¿”å›: `"memory": 45678912` (å­—èŠ‚)
- OJç³»ç»Ÿå­˜å‚¨: `"memory_used": 44608` (KB)
- è½¬æ¢å…¬å¼: `memory_used = memory / 1024`

#### çŠ¶æ€è½¬æ¢
```go
// çŠ¶æ€æ˜ å°„å‡½æ•°ç¤ºä¾‹
func mapGoJudgeStatus(goJudgeStatus string, exitStatus int, stage string) string {
    switch goJudgeStatus {
    case "Accepted":
        return "ACCEPTED"
    case "Memory Limit Exceeded":
        return "MEMORY_LIMIT_EXCEEDED"
    case "Time Limit Exceeded":
        return "TIME_LIMIT_EXCEEDED"
    case "Output Limit Exceeded":
        return "OUTPUT_LIMIT_EXCEEDED"
    case "Nonzero Exit Status":
        if stage == "compile" {
            return "COMPILE_ERROR"
        }
        return "RUNTIME_ERROR"
    case "Signalled":
        return "RUNTIME_ERROR"
    case "Dangerous Syscall":
        return "DANGEROUS_SYSCALL"
    case "File Error", "Internal Error":
        return "SYSTEM_ERROR"
    default:
        return "SYSTEM_ERROR"
    }
}
```

### 3. æ–‡ä»¶ç¼“å­˜ç®¡ç†ç­–ç•¥

#### ç¼“å­˜ç”Ÿå‘½å‘¨æœŸ
1. **ç¼–è¯‘é˜¶æ®µ**: ç”Ÿæˆclassæ–‡ä»¶ï¼Œè·å–fileId
2. **è¿è¡Œé˜¶æ®µ**: ä½¿ç”¨fileIdå¤šæ¬¡è¿è¡Œæµ‹è¯•ç”¨ä¾‹
3. **æ¸…ç†é˜¶æ®µ**: æ‰€æœ‰æµ‹è¯•å®Œæˆåç«‹å³åˆ é™¤ç¼“å­˜æ–‡ä»¶
4. **å¼‚å¸¸å¤„ç†**: åˆ¤é¢˜å¤±è´¥æ—¶ä¹Ÿè¦æ¸…ç†ç¼“å­˜æ–‡ä»¶

#### æ–‡ä»¶ç®¡ç†APIä½¿ç”¨
```bash
# åˆ—å‡ºæ‰€æœ‰ç¼“å­˜æ–‡ä»¶
GET /file

# è·å–ç‰¹å®šæ–‡ä»¶
GET /file/{fileId}

# åˆ é™¤ç¼“å­˜æ–‡ä»¶(å¿…é¡»è°ƒç”¨)
DELETE /file/{fileId}
```

### 4. é”™è¯¯å¤„ç†å®Œæ•´æ–¹æ¡ˆ

#### ç¼–è¯‘é”™è¯¯å¤„ç†
```json
{
  "status": "Nonzero Exit Status",
  "exitStatus": 1,
  "files": {
    "stderr": "Main.java:1: error: ';' expected"
  }
}
```
æ˜ å°„ä¸ºOJç³»ç»Ÿ:
```json
{
  "status": "COMPILE_ERROR",
  "compile_info": {
    "status": "FAILED",
    "message": "Main.java:1: error: ';' expected"
  }
}
```

#### è¿è¡Œæ—¶é”™è¯¯å¤„ç†
- `exitStatus: 0, status: "Accepted"` â†’ `ACCEPTED`
- `exitStatus: 1, status: "Nonzero Exit Status"` â†’ `RUNTIME_ERROR`
- `exitStatus: 9, status: "Signalled"` â†’ `RUNTIME_ERROR` (é€šå¸¸æ˜¯SIGKILL)
- `exitStatus: 11, status: "Signalled"` â†’ `RUNTIME_ERROR` (æ®µé”™è¯¯SIGSEGV)

### 5. æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### è¿æ¥æ± é…ç½®
```go
// HTTPå®¢æˆ·ç«¯é…ç½®
client := &http.Client{
    Timeout: 30 * time.Second,
    Transport: &http.Transport{
        MaxIdleConns:        10,
        MaxIdleConnsPerHost: 2,
        IdleConnTimeout:     30 * time.Second,
    },
}
```

#### å¹¶å‘æ§åˆ¶
- å•ä¸ªgo-judgeå®ä¾‹å»ºè®®æœ€å¤§å¹¶å‘: 10
- å¤šå®ä¾‹è´Ÿè½½å‡è¡¡ï¼Œæƒé‡åˆ†é…
- å®ä¾‹å¥åº·æ£€æŸ¥é—´éš”: 10ç§’

è¿™å¥—æ¥å£è®¾è®¡å®Œå…¨å…¼å®¹go-judgeæ²™ç®±çš„å®é™…ä½¿ç”¨æ–¹å¼ï¼Œç¡®ä¿äº†åˆ¤é¢˜æµç¨‹çš„æ­£ç¡®æ€§å’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚æ‰€æœ‰çŠ¶æ€æ˜ å°„ã€æ•°æ®è½¬æ¢ã€é”™è¯¯å¤„ç†éƒ½ä¸go-judgeæ¥å£è§„èŒƒå®Œå…¨å¯¹åº”ã€‚